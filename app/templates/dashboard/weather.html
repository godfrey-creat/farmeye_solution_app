<<<<<<< HEAD
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Farm Weather Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .weather-card {
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            background: white;
        }
        
        .weather-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }
        
        .weather-icon {
            font-size: 2.5rem;
            margin-right: 1rem;
        }
        
        .temperature {
            font-size: 2.5rem;
            font-weight: bold;
        }
        
        .condition {
            font-size: 1.2rem;
            color: #555;
        }
        
        .weather-details {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-top: 1.5rem;
        }
        
        .detail-item {
            text-align: center;
            padding: 0.5rem;
        }
        
        .detail-icon {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: #3498db;
        }
        
        .detail-value {
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .detail-label {
            font-size: 0.9rem;
            color: #777;
        }
        
        .forecast-card {
            background-color: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
        }

        .alert {
            padding: 0.75rem 1.25rem;
            margin-bottom: 1rem;
            border: 1px solid transparent;
            border-radius: 0.25rem;
        }
        
        .alert-warning {
            color: #856404;
            background-color: #fff3cd;
            border-color: #ffeeba;
        }
        
        .alert-info {
            color: #0c5460;
            background-color: #d1ecf1;
            border-color: #bee5eb;
        }
        
        .refresh-button {
            padding: 0.375rem 0.75rem;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .refresh-button:hover {
            background-color: #2980b9;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
        }

        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #3498db;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="weather-dashboard">
            <div class="weather-card">
                <div class="weather-header">
                    <h2>Farm Weather</h2>
                    <button class="refresh-button" id="refreshWeather">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                </div>
                
                <div id="weatherContent">
                    <div class="weather-main">
                        <div id="weatherIcon" class="weather-icon">
                            <i class="fas fa-cloud"></i>
                        </div>
                        <div>
                            <div id="temperature" class="temperature">-- °C</div>
                            <div id="condition" class="condition">--</div>
                        </div>
                    </div>
                    
                    <div class="weather-details">
                        <div class="detail-item">
                            <div class="detail-icon">
                                <i class="fas fa-tint"></i>
                            </div>
                            <div id="humidity" class="detail-value">--%</div>
                            <div class="detail-label">Humidity</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-icon">
                                <i class="fas fa-cloud-rain"></i>
                            </div>
                            <div id="rainfall" class="detail-value">-- mm</div>
                            <div class="detail-label">Rainfall</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-icon">
                                <i class="fas fa-wind"></i>
                            </div>
                            <div id="windSpeed" class="detail-value">-- m/s</div>
                            <div class="detail-label">Wind Speed</div>
                        </div>
                    </div>
                    
                    <div id="forecastContainer" class="forecast-card">
                        <i class="fas fa-cloud-sun"></i>
                        <span id="forecast">Loading forecast...</span>
                    </div>
                </div>

                <div id="loadingIndicator" class="loading">
                    <div class="spinner"></div>
                    <p>Fetching weather data...</p>
                </div>

                <div id="errorContainer"></div>
            </div>
        </div>
    </div>

    <script>
        // Get farm ID from URL or use a default value
        const urlParams = new URLSearchParams(window.location.search);
        const farmId = urlParams.get('farm_id') || '{{ farm_id }}';
        
        // Weather condition icons mapping
        const weatherIcons = {
            'Clear': '<i class="fas fa-sun" style="color: #f39c12;"></i>',
            'Clouds': '<i class="fas fa-cloud" style="color: #95a5a6;"></i>',
            'Rain': '<i class="fas fa-cloud-rain" style="color: #3498db;"></i>',
            'Drizzle': '<i class="fas fa-cloud-rain" style="color: #3498db;"></i>',
            'Thunderstorm': '<i class="fas fa-bolt" style="color: #f39c12;"></i>',
            'Snow': '<i class="fas fa-snowflake" style="color: #bdc3c7;"></i>',
            'Mist': '<i class="fas fa-smog" style="color: #95a5a6;"></i>',
            'Smoke': '<i class="fas fa-smog" style="color: #95a5a6;"></i>',
            'Haze': '<i class="fas fa-smog" style="color: #95a5a6;"></i>',
            'Dust': '<i class="fas fa-smog" style="color: #d35400;"></i>',
            'Fog': '<i class="fas fa-smog" style="color: #95a5a6;"></i>',
            'Sand': '<i class="fas fa-wind" style="color: #d35400;"></i>',
            'Ash': '<i class="fas fa-smog" style="color: #7f8c8d;"></i>',
            'Squall': '<i class="fas fa-wind" style="color: #7f8c8d;"></i>',
            'Tornado': '<i class="fas fa-wind" style="color: #c0392b;"></i>',
            'Unknown': '<i class="fas fa-question-circle" style="color: #95a5a6;"></i>'
        };

        // Function to fetch weather data
        function fetchWeatherData() {
            // Show loading indicator
            document.getElementById('weatherContent').style.display = 'none';
            document.getElementById('loadingIndicator').style.display = 'block';
            document.getElementById('errorContainer').innerHTML = '';
            
            // API endpoint
            const apiUrl = `/weather-data/${farmId}`;
            
            fetch(apiUrl)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    // Update the UI with the received data
                    updateWeatherUI(data);
                })
                .catch(error => {
                    console.error('Error fetching weather data:', error);
                    document.getElementById('errorContainer').innerHTML = `
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle"></i> 
                            Unable to fetch weather data. Please try again later.
                        </div>
                    `;
                })
                .finally(() => {
                    // Hide loading indicator
                    document.getElementById('loadingIndicator').style.display = 'none';
                    document.getElementById('weatherContent').style.display = 'block';
                });
        }

        // Function to update UI with weather data
        function updateWeatherUI(data) {
            // Basic weather info
            document.getElementById('temperature').textContent = `${data.temperature} °C`;
            document.getElementById('condition').textContent = data.condition;
            
            // Set weather icon based on condition
            const iconHtml = weatherIcons[data.condition] || weatherIcons['Unknown'];
            document.getElementById('weatherIcon').innerHTML = iconHtml;
            
            // Weather details
            document.getElementById('humidity').textContent = `${data.humidity}%`;
            document.getElementById('rainfall').textContent = `${data.rainfall} mm`;
            document.getElementById('windSpeed').textContent = `${data.wind_speed} m/s`;
            
            // Forecast
            const forecastContainer = document.getElementById('forecastContainer');
            const forecast = document.getElementById('forecast');
            forecast.textContent = data.forecast;
            
            // Style forecast based on content
            if (data.forecast.includes('unavailable') || data.forecast.includes('Set farm location')) {
                forecastContainer.classList.add('alert', 'alert-warning');
            } else if (data.forecast.includes('Rain expected')) {
                forecastContainer.classList.add('alert', 'alert-info');
            } else {
                forecastContainer.classList.remove('alert', 'alert-warning', 'alert-info');
            }
        }

        // Add event listener for refresh button
        document.getElementById('refreshWeather').addEventListener('click', fetchWeatherData);
        
        // Fetch weather data when the page loads
        document.addEventListener('DOMContentLoaded', fetchWeatherData);
    </script>
</body>
</html>
=======
{% extends "base.html" %} {% block title %}FarmEye - Weather Dashboard{%
endblock %} {% block extra_css %}
<style>
  .weather-gradient {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  }

  .weather-card {
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
  }

  .weather-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
  }

  .weather-icon {
    filter: drop-shadow(2px 4px 6px rgba(0, 0, 0, 0.1));
  }

  .forecast-scroll {
    scrollbar-width: thin;
    scrollbar-color: #cbd5e0 #f7fafc;
  }

  .forecast-scroll::-webkit-scrollbar {
    height: 6px;
  }

  .forecast-scroll::-webkit-scrollbar-track {
    background: #f7fafc;
    border-radius: 3px;
  }

  .forecast-scroll::-webkit-scrollbar-thumb {
    background: #cbd5e0;
    border-radius: 3px;
  }

  .wind-direction {
    animation: sway 3s ease-in-out infinite;
  }

  @keyframes sway {
    0%,
    100% {
      transform: rotate(-5deg);
    }
    50% {
      transform: rotate(5deg);
    }
  }
</style>
{% endblock %} {% block content %}
<!-- Location Header -->
<div class="bg-white rounded-xl shadow-lg p-6 mb-6">
  <div class="flex items-center justify-between">
    <div class="flex items-center space-x-4">
      <div
        class="w-16 h-16 bg-primary rounded-full flex items-center justify-center"
      >
        <i class="fas fa-map-marked-alt text-white text-2xl"></i>
      </div>
      <div>
        <h1 class="text-2xl font-bold text-gray-800">{{ farm.name }}</h1>
        <p class="text-gray-600">
          <i class="fas fa-location-dot text-primary mr-1"></i>
          {{ farm.location }}, {{ farm.region|title }}
        </p>
        <p class="text-sm text-gray-500">
          Coordinates: {{ "%.4f"|format(farm.latitude) }}, {{
          "%.4f"|format(farm.longitude) }}
        </p>
      </div>
    </div>
    <div class="text-right">
      <p class="text-sm text-gray-500">Last updated</p>
      <p class="text-lg font-semibold text-gray-800" id="last-update">
        <span id="current-time"></span>

        <script>
          function updateCurrentTime() {
            const now = new Date();
            const hours = now.getHours();
            const minutes = now.getMinutes();
            const ampm = hours >= 12 ? "PM" : "AM";
            const displayHours = hours % 12 || 12;
            const displayMinutes = minutes < 10 ? "0" + minutes : minutes;

            document.getElementById(
              "current-time"
            ).textContent = `${displayHours}:${displayMinutes} ${ampm}`;
          }

          // Update immediately
          updateCurrentTime();

          // Update every minute
          setInterval(updateCurrentTime, 60000);
        </script>
      </p>
      <button
        onclick="refreshWeather()"
        class="mt-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
      >
        <i class="fas fa-sync-alt mr-2"></i>Refresh
      </button>
    </div>
  </div>
</div>

{% if not has_location %}
<!-- No Location Message -->
<div class="bg-white rounded-xl p-8 shadow-lg text-center">
  <i class="fas fa-map-marker-alt text-6xl text-gray-400 mb-4"></i>
  <h2 class="text-2xl font-semibold mb-2">Location Required</h2>
  <p class="text-gray-600 mb-6">
    Please update your farm location to view weather data.
  </p>
  <a
    href="{{ url_for('farm.edit_farm', farm_id=farm.id) }}"
    class="inline-block px-6 py-3 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
  >
    <i class="fas fa-edit mr-2"></i>Update Farm Location
  </a>
</div>

{% elif error %}
<!-- Error State -->
<div class="bg-white rounded-xl p-8 shadow-lg text-center">
  <i class="fas fa-exclamation-circle text-6xl text-red-500 mb-4"></i>
  <h2 class="text-2xl font-semibold mb-2">Weather Data Unavailable</h2>
  <p class="text-gray-600 mb-6">
    Unable to fetch weather data. Please try again.
  </p>
  <button
    onclick="location.reload()"
    class="px-6 py-3 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
  >
    <i class="fas fa-redo mr-2"></i>Try Again
  </button>
</div>

{% else %}
<!-- Current Weather -->
<div class="weather-gradient rounded-xl p-6 mb-6 text-white">
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <!-- Main Weather Display -->
    <div class="flex items-center justify-between">
      <div>
        <h2 class="text-3xl font-bold mb-2">Current Weather</h2>
        <p class="text-5xl font-bold mb-2">{{ current.temp }}°C</p>
        <p class="text-xl mb-1">{{ current.description|title }}</p>
        <p class="text-lg opacity-90">Feels like {{ current.feels_like }}°C</p>
        <div class="flex items-center mt-4 space-x-4">
          <div>
            <i class="fas fa-wind mr-1"></i>
            {{ current.wind_speed }} km/h
          </div>
          <div>
            <i class="fas fa-tint mr-1"></i>
            {{ current.humidity }}%
          </div>
          <div>
            <i class="fas fa-eye mr-1"></i>
            {{ current.visibility }} km
          </div>
        </div>
      </div>
      <div class="text-center">
        <img
          src="https://openweathermap.org/img/wn/{{ current.icon }}@4x.png"
          alt="{{ current.description }}"
          class="weather-icon w-40 h-40 mx-auto"
        />
        <div class="mt-4 grid grid-cols-2 gap-4 text-sm">
          <div>
            <i class="fas fa-sunrise text-yellow-300"></i>
            {{ current.sunrise.strftime('%I:%M %p') }}
          </div>
          <div>
            <i class="fas fa-sunset text-orange-400"></i>
            {{ current.sunset.strftime('%I:%M %p') }}
          </div>
        </div>
      </div>
    </div>

    <!-- Weather Stats Grid -->
    <div class="grid grid-cols-2 gap-4">
      <div class="bg-white bg-opacity-20 rounded-lg p-4">
        <div class="flex items-center justify-between mb-2">
          <span class="text-sm opacity-90">UV Index</span>
          <i class="fas fa-sun text-yellow-300"></i>
        </div>
        <p class="text-2xl font-bold">{{ current.uvi }}</p>
        <p class="text-sm opacity-90">
          {% if current.uvi < 3 %}Low {% elif current.uvi < 6 %}Moderate {% elif
          current.uvi < 8 %}High {% elif current.uvi < 11 %}Very High {% else
          %}Extreme {% endif %}
        </p>
      </div>

      <div class="bg-white bg-opacity-20 rounded-lg p-4">
        <div class="flex items-center justify-between mb-2">
          <span class="text-sm opacity-90">Pressure</span>
          <i class="fas fa-compress-arrows-alt"></i>
        </div>
        <p class="text-2xl font-bold">{{ current.pressure }}</p>
        <p class="text-sm opacity-90">hPa</p>
      </div>

      <div class="bg-white bg-opacity-20 rounded-lg p-4">
        <div class="flex items-center justify-between mb-2">
          <span class="text-sm opacity-90">Dew Point</span>
          <i class="fas fa-temperature-low"></i>
        </div>
        <p class="text-2xl font-bold">{{ current.dew_point }}°C</p>
        <p class="text-sm opacity-90">Comfort level</p>
      </div>

      <div class="bg-white bg-opacity-20 rounded-lg p-4">
        <div class="flex items-center justify-between mb-2">
          <span class="text-sm opacity-90">Wind</span>
          <i
            class="fas fa-compass wind-direction"
            style="transform: rotate({{ current.wind_deg }}deg)"
          ></i>
        </div>
        <p class="text-2xl font-bold">{{ current.wind_speed }}</p>
        <p class="text-sm opacity-90">
          km/h {{ wind_direction(current.wind_deg) }}
        </p>
      </div>
    </div>
  </div>
</div>

<!-- Weather Alerts -->
{% if alerts %}
<div class="bg-red-50 border-l-4 border-red-500 rounded-lg p-4 mb-6">
  <div class="flex items-start">
    <i class="fas fa-exclamation-triangle text-red-500 text-xl mr-3 mt-1"></i>
    <div>
      <h3 class="text-lg font-semibold text-red-800">Weather Alert</h3>
      {% for alert in alerts %}
      <p class="text-red-700 mt-1">
        {{ alert.event }}: {{ alert.description }}
      </p>
      {% endfor %}
    </div>
  </div>
</div>
{% endif %}

<!-- Hourly Forecast -->
<div class="bg-white rounded-xl shadow-lg p-6 mb-6">
  <h2 class="text-2xl font-bold text-gray-800 mb-4">24-Hour Forecast</h2>
  <div class="overflow-x-auto forecast-scroll">
    <div class="flex space-x-4 pb-4">
      {% for hour in hourly[:24] %}
      <div
        class="weather-card bg-gray-50 rounded-lg p-4 min-w-[120px] text-center"
      >
        <p class="font-semibold text-gray-700">
          {{ hour.dt.strftime('%I %p') }}
        </p>
        <img
          src="https://openweathermap.org/img/wn/{{ hour.icon }}.png"
          alt="{{ hour.description }}"
          class="w-16 h-16 mx-auto my-2"
        />
        <p class="text-lg font-bold">{{ hour.temp }}°C</p>
        <div
          class="flex items-center justify-center mt-2 text-sm text-gray-600"
        >
          <i class="fas fa-tint text-blue-500 mr-1"></i>
          {{ hour.pop }}%
        </div>
        {% if hour.rain > 0 %}
        <p class="text-xs text-blue-600 mt-1">{{ hour.rain }}mm</p>
        {% endif %}
      </div>
      {% endfor %}
    </div>
  </div>
</div>

<!-- 7-Day Forecast -->
<div class="bg-white rounded-xl shadow-lg p-6 mb-6">
  <h2 class="text-2xl font-bold text-gray-800 mb-4">7-Day Forecast</h2>
  <div class="grid grid-cols-1 md:grid-cols-7 gap-4">
    {% for day in daily %}
    <div class="weather-card bg-gray-50 rounded-lg p-4 text-center">
      <p class="font-semibold text-gray-700">{{ day.dt.strftime('%a') }}</p>
      <p class="text-sm text-gray-600">{{ day.dt.strftime('%b %d') }}</p>
      <img
        src="https://openweathermap.org/img/wn/{{ day.icon }}.png"
        alt="{{ day.description }}"
        class="w-16 h-16 mx-auto my-2"
      />
      <p class="text-lg font-bold">{{ day.temp_max }}°</p>
      <p class="text-sm text-gray-600">{{ day.temp_min }}°</p>
      <div class="flex items-center justify-center mt-2 text-sm">
        <i class="fas fa-tint text-blue-500 mr-1"></i>
        {{ day.pop }}%
      </div>
      {% if day.rain > 0 %}
      <p class="text-xs text-blue-600 mt-1">{{ day.rain }}mm</p>
      {% endif %}
    </div>
    {% endfor %}
  </div>
</div>

<!-- Charts Section -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
  <!-- Temperature Chart -->
  <div class="bg-white rounded-xl shadow-lg p-6">
    <h3 class="text-xl font-semibold text-gray-800 mb-4">Temperature Trend</h3>
    <canvas id="temperatureChart" class="w-full h-64"></canvas>
  </div>

  <!-- Precipitation Chart -->
  <div class="bg-white rounded-xl shadow-lg p-6">
    <h3 class="text-xl font-semibold text-gray-800 mb-4">
      Precipitation Forecast
    </h3>
    <canvas id="precipitationChart" class="w-full h-64"></canvas>
  </div>
</div>

<!-- Farming Insights -->
<div class="bg-white rounded-xl shadow-lg p-6">
  <h2 class="text-2xl font-bold text-gray-800 mb-4">Farming Insights</h2>
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <!-- Dynamic insights based on conditions -->
    {% if current.temp > 30 and current.humidity < 40 %}
    <div class="bg-yellow-50 border-l-4 border-yellow-500 rounded-lg p-4">
      <div class="flex items-start">
        <i class="fas fa-exclamation-triangle text-yellow-500 text-xl mr-3"></i>
        <div>
          <h4 class="font-semibold text-yellow-800">Irrigation Recommended</h4>
          <p class="text-yellow-700">
            High temperature and low humidity. Consider irrigating your crops.
          </p>
        </div>
      </div>
    </div>
    {% endif %} {% if daily[0].temp_min < 5 %}
    <div class="bg-blue-50 border-l-4 border-blue-500 rounded-lg p-4">
      <div class="flex items-start">
        <i class="fas fa-snowflake text-blue-500 text-xl mr-3"></i>
        <div>
          <h4 class="font-semibold text-blue-800">Frost Warning</h4>
          <p class="text-blue-700">
            Low temperatures expected. Protect sensitive crops from frost.
          </p>
        </div>
      </div>
    </div>
    {% endif %} {% for day in daily[:3] if day.pop > 70 %}
    <div class="bg-green-50 border-l-4 border-green-500 rounded-lg p-4">
      <div class="flex items-start">
        <i class="fas fa-cloud-rain text-green-500 text-xl mr-3"></i>
        <div>
          <h4 class="font-semibold text-green-800">Rain Expected</h4>
          <p class="text-green-700">
            {{ day.pop }}% chance of rain on {{ day.dt.strftime('%A') }}.
          </p>
        </div>
      </div>
    </div>
    {% endfor %} {% if current.wind_speed > 25 %}
    <div class="bg-orange-50 border-l-4 border-orange-500 rounded-lg p-4">
      <div class="flex items-start">
        <i class="fas fa-wind text-orange-500 text-xl mr-3"></i>
        <div>
          <h4 class="font-semibold text-orange-800">Strong Winds</h4>
          <p class="text-orange-700">
            Secure greenhouse covers and support tall crops.
          </p>
        </div>
      </div>
    </div>
    {% endif %}
  </div>
</div>
{% endif %} {% endblock %} {% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // Wind direction helper
  function getWindDirection(degrees) {
      const directions = ['N', 'NNE', 'NE', 'ENE', 'E', 'ESE', 'SE', 'SSE', 'S', 'SSW', 'SW', 'WSW', 'W', 'WNW', 'NW', 'NNW'];
      const index = Math.round(degrees / 22.5) % 16;
      return directions[index];
  }

  // Refresh weather data
  async function refreshWeather() {
      try {
          const response = await fetch('/weather/api/current');
          const data = await response.json();
          // Update UI with new data
          location.reload(); // Simple reload for now
      } catch (error) {
          console.error('Error refreshing weather:', error);
      }
  }

  // Auto-refresh every 10 minutes
  setInterval(refreshWeather, 600000);

  // Initialize charts
  document.addEventListener('DOMContentLoaded', function() {
      // Temperature Chart
      const tempCtx = document.getElementById('temperatureChart').getContext('2d');
      new Chart(tempCtx, {
          type: 'line',
          data: {
              labels: [{% for hour in hourly[:24] %}'{{ hour.dt.strftime("%-I %p") }}'{% if not loop.last %},{% endif %}{% endfor %}],
              datasets: [{
                  label: 'Temperature (°C)',
                  data: [{% for hour in hourly[:24] %}{{ hour.temp }}{% if not loop.last %},{% endif %}{% endfor %}],
                  borderColor: '#667eea',
                  backgroundColor: 'rgba(102, 126, 234, 0.1)',
                  borderWidth: 3,
                  tension: 0.4,
                  fill: true
              }]
          },
          options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                  legend: { display: false }
              },
              scales: {
                  y: {
                      beginAtZero: false,
                      grid: { color: 'rgba(0, 0, 0, 0.05)' }
                  }
              }
          }
      });

      // Precipitation Chart
      const precipCtx = document.getElementById('precipitationChart').getContext('2d');
      new Chart(precipCtx, {
          type: 'bar',
          data: {
              labels: [{% for day in daily %}'{{ day.dt.strftime("%a") }}'{% if not loop.last %},{% endif %}{% endfor %}],
              datasets: [{
                  label: 'Rain Probability (%)',
                  data: [{% for day in daily %}{{ day.pop }}{% if not loop.last %},{% endif %}{% endfor %}],
                  backgroundColor: '#3b82f6',
                  borderRadius: 6
              }]
          },
          options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                  legend: { display: false }
              },
              scales: {
                  y: {
                      beginAtZero: true,
                      max: 100,
                      grid: { color: 'rgba(0, 0, 0, 0.05)' }
                  }
              }
          }
      });
  });

  // Jinja2 filter function
  window.wind_direction = function(degrees) {
      return getWindDirection(degrees);
  };
</script>
{% endblock %}
>>>>>>> origin/Dynamic-Parsing
